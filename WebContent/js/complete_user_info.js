define("common/js/complete_user_info",["require","jqueryValidate"],function(){jQuery.validator.addMethod("phoneb",function(e,i){var s=W.Validater.validateRules["require-mobile-phone"].regex;return-1!=e.indexOf("+")?!0:this.optional(i)||s.test(e)}),jQuery.validator.addMethod("email",function(e,i){var s=/^[a-zA-Z0-9]+([._\-][a-zA-Z0-9]+)*@([a-zA-Z0-9]+([._\-][a-zA-Z0-9]+))+$/;return this.optional(i)||s.test(e)}),jQuery.validator.addMethod("password",function(e,i){var s=/^[\w~`!@#$%&*()_+<>?:"'+*\/\-\^\\\][{}]{6,16}$/;return this.optional(i)||s.test(e)});var e,i=$("#improve-mode"),s=0,t="",o=0,n=0,r="";window.onload=function(){function d(){var e=$(".moco-modal-layer"),i=$(window).width(),s=$(window).height(),t=$(".moco-modal-layer").width(),o=$(".moco-modal-layer").height(),n=i/2-t/2,r=s/2-o/2;e.size()>0&&$(".moco-modal-layer").css({left:n,top:r})}if(i.size()>0){-1!=location.href.indexOf("lesson")&&1==OP_CONFIG.completelearn&&(1==OP_CONFIG.completeuinfotype||2==OP_CONFIG.completeuinfotype)&&(window.location.href="//www.imooc.com/index/usercheck?type=1&uid="+OP_CONFIG.userInfo.uid),s=0;var l=$("#improve-mode").prop("outerHTML"),g=$.dialog(l,{title:"完善个人信息",modal:!0});g.boxy.find(".moco-icon-close").hide();var c=function(e){clearInterval(n),n=null,r=e.code,t=e.pubkey,o=e.servertime,setInterval(function(){o++},1e3)},u=$(".moco-modal-layer .improve").data("flag");switch(e=$(".moco-modal-layer .improve").validate({errorPlacement:function(e,i){$(i).closest(".box").find(".help-inline").html("").append($(e))}}),u){case 1:$(".moco-modal-layer .js-phone").rules("add",{required:!0,phoneb:!0,messages:{required:"请输入手机号码",phoneb:"请输入正确的手机号码"}}),$(".moco-modal-layer .js-mobileverify").rules("add",{required:!0,messages:{required:"请输入验证码"}}),$(".moco-modal-layer .js-email").rules("add",{required:!0,email:!0,messages:{required:"请输入邮箱",email:"请输入正确的邮箱地址"}}),$(".moco-modal-layer .js-password").rules("add",{required:!0,password:!0,messages:{required:"请输入登录密码",password:"密码格式不正确"}});break;case 2:$(".moco-modal-layer .js-phone").rules("add",{required:!0,phoneb:!0,messages:{required:"请输入手机号码",phoneb:"请输入正确的手机号码"}}),$(".moco-modal-layer .js-mobileverify").rules("add",{required:!0,messages:{required:"请输入验证码"}});break;case 3:$(".moco-modal-layer .js-email").rules("add",{required:!0,email:!0,messages:{required:"请输入邮箱",email:"请输入正确的邮箱地址"}})}}window.onresize=function(){d()},$(".moco-modal-layer").delegate(".js-phone","change",function(){s=0});var m=function(e){var i=e.val();$.post("/passport/user/checkphone",{phone:i},function(i){10001==i.status?($(".getCode").removeClass("sending"),$(".js-voicecode-send").removeClass("sending")):90010==i.status?($(".getCode").removeClass("sending"),$(".js-voicecode-send").removeClass("sending"),e.next().html("手机号已被使用")):($(".getCode").addClass("sending"),$(".js-voicecode-send").addClass("sending"),e.next().html(i.msg))},"json")},h=function(e,i){if(e.hasClass("sending"))return!1;var t=$(".moco-modal-layer .getCode");t.closest(".improve").find(".js-phone").siblings(".help-inline").html("");var o=$(".moco-modal-layer .js-phone").val(),n={phone:o,noverify:1};if(1==s&&(n.forcebind=1),1==i){if(-1!=o.indexOf("+"))return void t.closest(".improve").find(".js-phone").siblings(".help-inline").html("国外手机号不支持语音验证码");n.typecode=1}var r,a=60;r=setInterval(function(){if(0>=a)clearInterval(r),t.closest(".improve").find(".js-phone").siblings(".help-inline").html(""),t.addClass("active").text("短信接收").removeClass("sending"),t.after('<p class="voicecode-send js-voicecode-send"><i class="imv2-vol_up"></i>语音接听</p>'),e.removeClass("sending");else{var i=--a+"s 后重新获取";t.text(i).removeClass("active"),$(".moco-modal-layer .js-voicecode-send").remove()}},1e3),e.addClass("sending"),$.ajax({url:"/passport/user/checkphonecode",type:"post",data:n,dataType:"json",success:function(i){if(10001!=i.status)if(90013==i.status){var o='手机号码已被使用，是否强制绑定到现有账户中？<i class="js-mandatory-yes">是</i>';t.closest(".improve").find(".js-phone").siblings(".help-inline").html(o),clearInterval(r),t.addClass("active").text("短信接收").removeClass("sending"),t.after('<p class="voicecode-send js-voicecode-send"><i class="imv2-vol_up"></i>语音接听</p>'),s=0}else 11011==i.status?$.alert(i.msg):(t.closest(".improve").find(".js-phone").siblings(".help-inline").html(i.msg),clearInterval(r),e.removeClass("sending"),t.addClass("active").text("短信接收").removeClass("sending"),0==$(".moco-modal-layer .js-voicecode-send").length&&t.after('<p class="voicecode-send js-voicecode-send"><i class="imv2-vol_up"></i>语音接听</p>'))}})};$(".moco-modal-layer").on("click",".getCode",function(){h($(this),0)}).on("click",".js-voicecode-send",function(){h($(this),1)}).on("blur",".js-phone",function(){m($(this))}).on("click",".submitBtn",function(){var i=$(this),t=$(".moco-modal-layer .js-phone").val(),n=$(".moco-modal-layer .js-mobileverify").val(),d=$(".moco-modal-layer .js-email").val(),l=$(".moco-modal-layer .js-password").val();if(e.form()){$(".moco-modal-layer .js-password").size()>0&&($.ajax({url:"/passport/user/prelogin",async:!1,type:"post",dataType:"json",success:function(e){10001==e.status&&c(e)}}),l=a(r+"	"+o+"	"+l),l=window.btoa(l));var g={phone:t,mobileverify:n,email:d,password:l};1==s&&(g.forcebind=1),$.ajax({url:"/passport/user/completeuserinfo",type:"post",data:g,dataType:"json",success:function(e){if(10001!=e.status&&11010!=e.status)if(90013==e.status){var i='手机号码已被使用，是否强制绑定到现有账户中？<i class="js-mandatory-yes">是</i>';$(".js-phone").siblings(".help-inline").html(i),$(".moco-modal-layer").find(".getCode").addClass("sending"),s=0}else if(11011==e.status)$.alert(e.msg);else if(11012==e.status)$.alert(e.msg);else for(var t in e.data)$(".js-"+t).closest(".box").find(".help-inline").html(e.data[t].msg);else 11010==e.status?window.location.href=window.location.href:($(".js-modal-close").click(),$.alert("恭喜你，完善个人信息成功"))},error:function(){i.closest(".box").find("help-inline").html("服务器无响应，稍后重试")}})}}).on("click",".js-pw",function(){$(this).hasClass("cur")?($(".moco-modal-layer .js-password").attr("type","password"),$(this).removeClass("cur")):($(".moco-modal-layer .js-password").attr("type","text"),$(this).addClass("cur"))}).on("click",".cancelBtn",function(){$(".js-modal-close").click()}),$(".help-inline").delegate(".js-mandatory-yes","click",function(){s=1,$(".moco-modal-layer").find(".getCode").removeClass("sending"),$(".getCode").trigger("click"),$(this).parent(".help-inline").html("")})};var a=function(e){function i(e){O=e,S=new Array(O);for(var i=0;i<S.length;i++)S[i]=0;P=new s,F=new s,F.digits[0]=1}function s(e){this.digits="boolean"==typeof e&&1==e?null:S.slice(0),this.isNeg=!1}function o(e){var i=new s(!0);return i.digits=e.digits.slice(0),i.isNeg=e.isNeg,i}function n(e){var i=new s;i.isNeg=0>e,e=Math.abs(e);for(var t=0;e>0;)i.digits[t++]=e&V,e>>=G;return i}function r(e){var i,s=48,t=s+9,o=97,n=o+25,r=65,a=90;return i=e>=s&&t>=e?e-s:e>=r&&a>=e?10+e-r:e>=o&&n>=e?10+e-o:0}function a(e){for(var i=0,s=Math.min(e.length,4),t=0;s>t;++t)i<<=4,i|=r(e.charCodeAt(t));return i}function d(e){for(var i=new s,t=e.length,o=t,n=0;o>0;o-=4,++n)i.digits[n]=a(e.substr(Math.max(o-4,0),Math.min(o,4)));return i}function l(e){for(var i="",s=m(e);s>-1;--s)i+=g(e.digits[s]);return i}function g(e){var i=String.fromCharCode(255&e);e>>>=8;var s=String.fromCharCode(255&e);return s+i}function c(e,i){var t;if(e.isNeg!=i.isNeg)i.isNeg=!i.isNeg,t=u(e,i),i.isNeg=!i.isNeg;else{t=new s;for(var o,n=0,r=0;r<e.digits.length;++r)o=e.digits[r]+i.digits[r]+n,t.digits[r]=65535&o,n=Number(o>=Z);t.isNeg=e.isNeg}return t}function u(e,i){var t;if(e.isNeg!=i.isNeg)i.isNeg=!i.isNeg,t=c(e,i),i.isNeg=!i.isNeg;else{t=new s;var o,n;n=0;for(var r=0;r<e.digits.length;++r)o=e.digits[r]-i.digits[r]+n,t.digits[r]=65535&o,t.digits[r]<0&&(t.digits[r]+=Z),n=0-Number(0>o);if(-1==n){n=0;for(var r=0;r<e.digits.length;++r)o=0-t.digits[r]+n,t.digits[r]=65535&o,t.digits[r]<0&&(t.digits[r]+=Z),n=0-Number(0>o);t.isNeg=!e.isNeg}else t.isNeg=e.isNeg}return t}function m(e){for(var i=e.digits.length-1;i>0&&0==e.digits[i];)--i;return i}function h(e){var i,s=m(e),t=e.digits[s],o=(s+1)*T;for(i=o;i>o-T&&0==(32768&t);--i)t<<=1;return i}function f(e,i){for(var t,o,n,r=new s,a=m(e),d=m(i),l=0;d>=l;++l){for(t=0,n=l,j=0;a>=j;++j,++n)o=r.digits[n]+e.digits[j]*i.digits[l]+t,r.digits[n]=o&V,t=o>>>G;r.digits[l+a+1]=t}return r.isNeg=e.isNeg!=i.isNeg,r}function v(e,i){var t,o,n;result=new s,t=m(e),o=0;for(var r=0;t>=r;++r)n=result.digits[r]+e.digits[r]*i+o,result.digits[r]=n&V,o=n>>>G;return result.digits[1+t]=o,result}function p(e,i,s,t,o){for(var n=Math.min(i+o,e.length),r=i,a=t;n>r;++r,++a)s[a]=e[r]}function y(e,i){var t=Math.floor(i/T),o=new s;p(e.digits,0,o.digits,t,o.digits.length-t);for(var n=i%T,r=T-n,a=o.digits.length-1,d=a-1;a>0;--a,--d)o.digits[a]=o.digits[a]<<n&V|(o.digits[d]&H[n])>>>r;return o.digits[0]=o.digits[a]<<n&V,o.isNeg=e.isNeg,o}function w(e,i){var t=Math.floor(i/T),o=new s;p(e.digits,t,o.digits,0,e.digits.length-t);for(var n=i%T,r=T-n,a=0,d=a+1;a<o.digits.length-1;++a,++d)o.digits[a]=o.digits[a]>>>n|(o.digits[d]&L[n])<<r;return o.digits[o.digits.length-1]>>>=n,o.isNeg=e.isNeg,o}function $(e,i){var t=new s;return p(e.digits,0,t.digits,i,t.digits.length-i),t}function N(e,i){var t=new s;return p(e.digits,i,t.digits,0,t.digits.length-i),t}function b(e,i){var t=new s;return p(e.digits,0,t.digits,0,i),t}function C(e,i){if(e.isNeg!=i.isNeg)return 1-2*Number(e.isNeg);for(var s=e.digits.length-1;s>=0;--s)if(e.digits[s]!=i.digits[s])return e.isNeg?1-2*Number(e.digits[s]>i.digits[s]):1-2*Number(e.digits[s]<i.digits[s]);return 0}function k(e,i){var t,n,r=h(e),a=h(i),d=i.isNeg;if(a>r)return e.isNeg?(t=o(F),t.isNeg=!i.isNeg,e.isNeg=!1,i.isNeg=!1,n=u(i,e),e.isNeg=!0,i.isNeg=d):(t=new s,n=o(e)),new Array(t,n);t=new s,n=e;for(var l=Math.ceil(a/T)-1,g=0;i.digits[l]<Q;)i=y(i,1),++g,++a,l=Math.ceil(a/T)-1;n=y(n,g),r+=g;for(var f=Math.ceil(r/T)-1,p=$(i,f-l);-1!=C(n,p);)++t.digits[f-l],n=u(n,p);for(var N=f;N>l;--N){var j=N>=n.digits.length?0:n.digits[N],b=N-1>=n.digits.length?0:n.digits[N-1],k=N-2>=n.digits.length?0:n.digits[N-2],M=l>=i.digits.length?0:i.digits[l],x=l-1>=i.digits.length?0:i.digits[l-1];t.digits[N-l-1]=j==M?V:Math.floor((j*Z+b)/M);for(var q=t.digits[N-l-1]*(M*Z+x),z=j*B+(b*Z+k);q>z;)--t.digits[N-l-1],q=t.digits[N-l-1]*(M*Z|x),z=j*Z*Z+(b*Z+k);p=$(i,N-l-1),n=u(n,v(p,t.digits[N-l-1])),n.isNeg&&(n=c(n,p),--t.digits[N-l-1])}return n=w(n,g),t.isNeg=e.isNeg!=d,e.isNeg&&(t=d?c(t,F):u(t,F),i=w(i,g),n=u(i,n)),0==n.digits[0]&&0==m(n)&&(n.isNeg=!1),new Array(t,n)}function M(e,i){return k(e,i)[0]}function x(e){this.modulus=o(e),this.k=m(this.modulus)+1;var i=new s;i.digits[2*this.k]=1,this.mu=M(i,this.modulus),this.bkplus1=new s,this.bkplus1.digits[this.k+1]=1,this.modulo=q,this.multiplyMod=z,this.powMod=A}function q(e){var i=N(e,this.k-1),s=f(i,this.mu),t=N(s,this.k+1),o=b(e,this.k+1),n=f(t,this.modulus),r=b(n,this.k+1),a=u(o,r);a.isNeg&&(a=c(a,this.bkplus1));for(var d=C(a,this.modulus)>=0;d;)a=u(a,this.modulus),d=C(a,this.modulus)>=0;return a}function z(e,i){var s=f(e,i);return this.modulo(s)}function A(e,i){var t=new s;t.digits[0]=1;for(var o=e,n=i;;){if(0!=(1&n.digits[0])&&(t=this.multiplyMod(t,o)),n=w(n,1),0==n.digits[0]&&0==m(n))break;o=this.multiplyMod(o,o)}return t}function _(e){var i=1024;this.e=d("10001"),this.d=d(""),this.m=d(e),this.chunkSize="number"!=typeof i?2*m(this.m):i/8,this.radix=16,this.barrett=new x(this.m)}function I(e){var i,o,n,r,a,d,g,c,u=new Array,m=e.length,h="",f=new _(t);for(m>f.chunkSize-11&&(m=f.chunkSize-11),i=0,o=m-1;m>i;)u[o]=e.charCodeAt(i),i++,o--;for(o=f.chunkSize-m%f.chunkSize;o>0;){for(r=Math.floor(256*Math.random());!r;)r=Math.floor(256*Math.random());u[i]=r,i++,o--}for(u[m]=0,u[f.chunkSize-2]=2,u[f.chunkSize-1]=0,a=u.length,i=0;a>i;i+=f.chunkSize){for(d=new s,o=0,n=i;n<i+f.chunkSize;++o)d.digits[o]=u[n++],d.digits[o]+=u[n++]<<8;g=f.barrett.powMod(d,f.e),c=l(g),h+=c}return h}var O,S,P,F,G=16,T=G,Z=65536,Q=Z>>>1,B=Z*Z,V=Z-1;i(20);var H=(n(1e15),new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"),new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"),new Array(0,32768,49152,57344,61440,63488,64512,65024,65280,65408,65472,65504,65520,65528,65532,65534,65535)),L=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535);return i(131),I(e)}});