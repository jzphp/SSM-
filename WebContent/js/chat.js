define("common/js/chat",["jquery","socketio"],function(n,e){function t(n){for(var e,t={},i=document.cookie.split(/ *; */),o=0;o<i.length;++o)e=i[o].split("="),t[decodeURIComponent(e[0])]=decodeURIComponent(e[1]);return n?t[n]:t}if(n.chat={},n.chat={iosocket:null,unreadEvent:null,uid:0,port:80,ready:[],analyzeData:null,events:{},ie:navigator.userAgent.match(/(?:\b(MS)?IE\s+|\bTrident\/7\.0;.*\s+rv:)(\d+)/),init:function(){this.iosocket=this.ie&&this.ie[2]<10?e("https://im.mukewang.com",{enablesXDR:!0,upgrade:!1,transports:["polling"],path:"/message",reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:6e5}):e("https://im.mukewang.com",{transports:["websocket"],path:"/message",reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:6e5});var i=t(),o=(i.cninfo||"").split("-"),s=i.imooc_uuid,a=i.imooc_isnew;this.analyzeData={marking:o[1]||"",channel:o[0]||"",uuid:s||"",isnew:a||1,url:window.location.href,uid:OP_CONFIG.userInfo&&OP_CONFIG.userInfo.uid||0,isweb:1};for(var r in this.events)this.iosocket.on(r,this.events[r]);this.iosocket.on("connect",function(){var e,t,i=n.chat,o=i.ready||[],s=i.iosocket;for(e=0,t=o.length;t>e;e++)s.emit.apply(s,o[e])}),this.checkUnreads()},login:function(n){n.expand=this.analyzeData,this.iosocket.emit("login",n)},emit:function(n,e){this.ready?this.ready.push(arguments):this.iosocket.emit(n,e)},bandUnreads:function(n,e){n&&e&&(this.uid=n),this.events.unreads=e,this.iosocket&&this.iosocket.on("unreads",e)},checkUnreads:function(){this.analyzeData.uid=this.uid,this.emit("unreads",this.analyzeData),this.uid>0},bindEvent:function(n,e){this.iosocket?this.iosocket.on(n,e):this.events[n]=e},send:function(n,e){this.iosocket.emit(n,e)}},OP_CONFIG.userInfo&&OP_CONFIG.userInfo.uid){var i=window.location.href.indexOf("notices"),o=window.location.href.indexOf("messages");n.chat.bandUnreads(OP_CONFIG.userInfo.uid,function(e){e>0?(n(".msg_remind").show(),_msg_unread=1,(-1!=i||-1!=o)&&(e>99?n("#msg_new").find(".msg-num").html("(99+)").show():n("#msg_new").find(".msg-num").html("("+e+")").show())):(_msg_unread=0,_not_unread||n(".msg_remind").hide(),n("#msg_new").find(".msg-num").hide())}),n.chat.bindEvent("remind",function(e){if(e.unreads>0){if(n(".msg_remind").show(),_not_unread=1,-1!=i||-1!=o){var t=n("#not_new").find(".not-num"),s=t.html();if(""==s)n("#not_new").find(".not-num").html("(1)").show();else{var a=parseInt(t.text().substr(1,t.text().length-2)),r=parseInt(a+1);99==r?t.show().html("(99+)"):t.html("("+r+")")}}}else _not_unread=0,_msg_unread||n(".msg_remind").hide()})}});