define(function(require){require("common"),require("/static/page/course/course.layout.js"),require("/static/page/course/common/course_common.js"),require("/static/page/course/common/course_collection.js");var a=require("store"),c=parseInt(navigator.userAgent.indexOf("Chrome/"))+7,h=navigator.userAgent.slice(c).split(".");parseInt(h[0])>=50&&$(".chapter-introubox").find(".chapter-content").css({width:"280px","white-space":"pre-line","text-align":"center"}),$(function(){var c=a.get("mid_href");""!=c&&void 0!=c&&void 0==a.get("uid")?($(".learnchapter .video  a").each(function(){$(this).attr("href")==c&&($(this).parents(".learnchapter").addClass("learnchapter-active"),$(this).parents(".video").show(),$(this).parents(".learnchapter").find("span").removeClass("js-close").addClass("js-open"))}),a.remove("mid_href")):void 0==a.get("uid"),$(".back-btn").on("click",function(){return window.location=document.referrer&&-1!=document.referrer.indexOf("course/list")?document.referrer:"/course/list",!1}),$(".video li").bind("click",function(){var c=$(this).find("a").attr("href");a.set("mid_href",c)}),$(".course-chapters").on("click","h3, .J-media-item",function(){var a=$(this);if(a.hasClass("J-media-item")){if(!isLogin)return seajs.use("login_sns",function(a){a.init()}),!1}else{var c=a.find("span"),h=a.parents(".chapter");h.toggleClass("chapter-active"),h.hasClass("chapter-active")?c.removeClass("js-close").addClass("js-open"):c.removeClass("js-open").addClass("js-close")}}),$(".chapter").delegate(".chapter-info","mouseover",function(){$(this).find(".triangle").show();var a=-($(this).find(".chapter-introubox").width()/2-8)+"px";$(this).find(".chapter-introubox").css("left",a)}),$(".chapter").delegate(".chapter-info","mouseleave",function(){$(this).find(".triangle").hide()})}),1==hasLearn&&$.ajax({type:"post",url:"/course/ajaxusermediasstatus?cid="+GC.course.id,success:function(a){var c,h=[];if(0==a.result){var v=a.data,g=$(".course-chapters").find("li");$(g).each(function(a){h.push($(g[a]).attr("data-media-id"))}),$(h).each(function(a){if(""==v){var g=$(".course-chapters").find("li").eq(a);return c='<i class="icon-nolearn start"></i>',void $(g).find("a").prepend(c)}if(h[a]==learnChapter&&($(".course-chapters").find("li").eq(a).prepend('<em class="laststudy">最近学习</em>'),$(".course-chapters").find("li").eq(a).parents(".chapter").addClass("chapter-active"),$(".course-chapters").find("li").eq(a).parents(".video").siblings("h3").find("span").addClass(".js-open")),v[h[a]]){var g=$(".course-chapters").find("li").eq(a);c=1==v[h[a]].finished?'<i class="icon-tick-revert done"></i>':'<i class="icon-half ing"></i>',$(g).find("a").prepend(c)}else{var g=$(".course-chapters").find("li").eq(a);c='<i class="icon-nolearn start"></i>',$(g).find("a").prepend(c)}})}}});var v,g=$(".bdsharebuttonbox a"),C=GC.course.id,j=0,b=5e3;g.on("click",function(e){j||(j=1,shareFrame.hide(),$.ajax({type:"post",url:"/course/courseshare",data:"id="+C+"&type=0",success:function(){j=0},error:function(){layer.msg("网络错误，请稍后再试",1,1)},complete:function(){isAjax=0}}),e.preventDefault())}).mouseenter(function(){shareFrame.show()}).mouseleave(function(){v&&clearTimeout(v),v=setTimeout(function(){shareFrame.hide()},b)})});